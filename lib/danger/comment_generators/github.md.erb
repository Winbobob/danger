<!--
  <%- @tables.each do |table| -%>
  <%= pluralize(table[:name], table[:count]) %><%= ": #{truncate(table[:content].first.message)}" if table[:count] > 0 %>
  <%- end -%>
  <%= pluralize("Markdown", @markdowns.size) %>
-->
<%- @tables.each do |table| -%>
  <%- if table[:content].any? || table[:resolved].any? -%>
<table>
  <thead>
    <tr>
      <%- if table[:name] != "Message" -%>
        <th></th>
      <%- end -%>
      <th></th>
      <th width="100%" data-danger-table="true" data-kind="<%= table[:name] %>">
        <%- if table[:count] > 0 -%>
          <%= pluralize(table[:name], table[:count]) %>
        <%- else -%>
          :white_check_mark: <%= random_compliment %>
        <%- end -%>
      </th>
     </tr>
  </thead>

  <tbody>
    <%- max_num_violations = FindMaxNumViolations.new(table[:content]).call -%>
    <%- row_count = [max_num_violations, table[:content].length()].min -%>
    <%- table[:content].take(max_num_violations).each_with_index do |violation, index| -%>
      <tr>
        <%- if table[:name] != "Message" -%>
          <td><%= index + 1 %></td>
        <%- end -%>
        <td>:<%= table[:emoji] %>:</td>
        <td data-sticky="<%= violation.sticky %>"><%= violation.message %></td>
      </tr>
    <%- end -%>

    <%- if table[:content].length > max_num_violations -%>
      <tr>
        <%- if table[:name] != "Message" -%>
          <%- row_count += 1 -%>
          <td><%= row_count %></td>
        <%- end -%>
        <td>:warning:</td>
        <td>
        Danger found <%= table[:content].length %> violations with this PR. Due to GitHub's max issue comment size, the number shown has been truncated to <%= max_num_violations %>.
        </td>
        <%- if table[:name] != "Message" -%>
          <td></td>
        <%- end -%>
      </tr>
    <%- end -%>

    <%- row_count += 1 -%>
    <%- table[:resolved].each_with_index do |message, index| -%>
      <tr>
        <%- if table[:name] != "Message" -%>
          <td><%= row_count + index %></td>
        <%- end -%>
        <td>:white_check_mark:</td>
        <td data-sticky="true"><del><%= message %></del></td>
      </tr>
    <%- end -%>
  </tbody>
</table>
  <%- end -%>
<%- end -%>

<p align="right" data-meta="generated_by_<%= @danger_id %>">
  Generated by <a href="https://github.com/expertiza-bot">expertiza-bot</a>
</p>
